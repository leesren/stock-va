<!DOCTYPE html>
<html>

<head>
    <title>股价估值计算器（最终版）</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 15px auto;
            background-color: #f8f9fa
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            overflow-x: auto
        }

        td,
        th {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left
        }

        th {
            background-color: #f5f5f5;
            width: 160px;
            text-align: right
        }

        input {
            width: calc(100% - 20px);
            padding: 8px;
            margin-bottom: 10px
        }

        .btn {
            background-color: #2c3e50;
            color: white;
            padding: 15px 30px;
            border: none;
            display: block;
            margin-top: 20px;
            cursor: pointer;
            flex:1;
        }
        .btn1{
            background-color: #b873e8;
        }
        

        .btn:hover {
            background-color: #3498db
        }
        .btn1:hover {
            background-color: #d24fe6
        }

        .red-border {
            border: 1px solid red
        }

        .red-row {
            background-color: #ffebee;
        }

        .warning {
            color: red;
            font-size: 0.9em
        }

        .active {
            background-color: bisque;
        }

        p {
            font-weight: normal
        }

        .item {
            display: flex;
            align-items: center;
        }

        .item label {
            width: 170px
        }
        .contetn{
            padding: 0 15px;
        }
        body{
            font-size: 15px;
        }
    </style>
</head>

<body>

    <h2 style="text-align: center; color: #2c3e50">股价估值计算器</h2>
    <div class="contetn">

        <form id="valuation-form">
            <div class="item">
                <label for="stock-name" style="display: block; margin-bottom: 10px">股票名称：</label>
                <input type="text" id="stock-name"   placeholder="请输入">
            </div>
            <div class="item">
                <label for="roe" style="display: block; margin-bottom: 10px">ROE（%）：</label>
                <input type="number" id="roe"   placeholder="请输入">
            </div>
    
            <div class="item">
                <label for="eps" style="display: block; margin-bottom: 10px">EPS（元）：</label>
                <input type="number" id="eps"    placeholder="请输入">
            </div>
            <div class="item">
                <label for="treasury-rate" style="display: block; margin-bottom: 10px">国债利率（%）：</label>
                <input type="number" id="treasury-rate"  placeholder="请输入" />
            </div>
    
            <div class="item">
                <label for="historical-min" style="display: block; margin-bottom: 10px">历史最低价：</label>
                <input type="number" id="historical-min"  placeholder="请输入" />
            </div>
    
    
            <div class="item">
                <label for="historical-max" style="display: block; margin-bottom: 10px">历史最高价：</label>
                <input type="number" id="historical-max"  placeholder="请输入" />
            </div>
    
            <div class="item">
                <label for="current-pb" style="display: block; margin-bottom: 10px">当前PB：</label>
                <input type="number" id="current-pb"   placeholder="请输入" />
            </div>
    
    
            <div class="item">
                <label for="stockValue" style="display: block; margin-bottom: 10px">当前股价：</label>
                <input type="number" id="stockValue"   placeholder="请输入" />
            </div>
    
            <div class="item">
                <button type="button" class="btn btn1" onclick="reset()">清空</button>
                <button type="button" class="btn" onclick="calculate(this)">计算</button>
            </div>
           
        </form>
    
        
    
        <div id="analysis"
            style="margin-top: 20px; padding: 15px; background-color: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1)">
        </div>
    </div>

    <script>
       function reset(value={}) {
            document.getElementById('stock-name').value = value.name || '';
            document.getElementById('roe').value = value.roe || '';
            document.getElementById('eps').value = value.eps || '';
            document.getElementById('treasury-rate').value = value.rate || '';
            document.getElementById('historical-min').value = value.min || '';
            document.getElementById('historical-max').value = value.max || '';
            document.getElementById('current-pb').value = value.pb || '';
            document.getElementById('stockValue').value = value.va || '';
        }

        // 计算函数
        function calculate(evt) {
           !evt && reset({
                name:'公牛集团',
                roe:30,
                eps:3.37,
                rate: 3,
                min:52,
                max:112,
                pb: 6.53,
                va: 74.98
            })
            // 获取输入并转为数值
            const roe = (parseFloat(document.getElementById('roe').value) / 100 || 0).toFixed(2);
            const roeVa = roe * 100;
            const eps = parseFloat(document.getElementById('eps').value) || 0;
            const treasuryRate = (parseFloat(document.getElementById('treasury-rate').value) / 100 || 0).toFixed(2);
            const historicalMin = parseFloat(document.getElementById('historical-min').value);
            const historicalMax = parseFloat(document.getElementById('historical-max').value);
            const currentPbInput = document.getElementById('current-pb');
            const stockName = document.getElementById('stock-name').value
            const stockValue = parseFloat(document.getElementById('stockValue').value || 0) || 0;
            const currentPb = parseFloat(currentPbInput.value || 0);
            // 验证输入有效性
            if (roe <= 0 || eps <= 0) {
                alert("请输入有效的ROE和EPS！");
                return;
            }

            // 计算每股净资产（B）
            const b = eps / roe;

            
 
            const BValue = (eps / roe).toFixed(2) * 1;
            const currentVPb = (stockValue / BValue).toFixed(2) * 1;
            const ror = (currentVPb / BValue).toFixed(2);
            const addRate = (roe * 100 / currentVPb).toFixed(2);
            const latestRate = (addRate - treasuryRate * 100).toFixed(2);
            const bondRate = (roe*100 / 100 * currentPb).toFixed(2) * 1;
            // 显示分析结论
            document.getElementById('analysis').innerHTML = `
        <div id="preview-contents" class="note-content" style="padding-left: 35px; padding-right: 35px; padding-bottom: 115px;">

    <div id="wmd-preview-section-25" class="wmd-preview-section preview-content">

        <h3 id="1-核心公式"><strong>1. 核心公式</strong></h3>

        <p> <br>
             <b>股价 = PB * B <b/><br><br>
            其中： </p>

        <ul>
            <li>
                <p><strong>PB</strong> = ROE / (国债利率 + 风险溢价) </p>
            </li>
            <li>
                <p><strong>B</strong> = EPS / ROE（每股净资产）</p>
            </li>
        </ul>

        <hr>

    </div>
    <div id="wmd-preview-section-26" class="wmd-preview-section preview-content">

        <h3 ><strong>2. 代入【${stockName}】数据</strong></h3>

    </div>
     <div id="preview-contents" class="note-content" style="">
  <div id="wmd-preview" class="preview-content"></div>
  <div id="wmd-preview-section-24" class="wmd-preview-section preview-content">
    <hr>
  </div>
  <div id="wmd-preview-section-25" class="wmd-preview-section preview-content">

    <h4 id="1-计算每股净资产b"><strong>A. 计算每股净资产（B）</strong></h4>

    <p><b>B = EPS / ROE </b>= ${eps} / ${roe * 100}% = ${BValue} 元</p>

    <hr>

  </div>
  <div id="wmd-preview-section-26" class="wmd-preview-section preview-content">

    <h4 id="2-计算当前pb"><strong>2. 计算当前PB</strong></h4>

    <p><b>PB = 股价 / B </b>= ${stockValue} / ${BValue} = ${(stockValue / BValue).toFixed(2)} 倍</p>

    <hr>

  </div>
  <div id="wmd-preview-section-27" class="wmd-preview-section preview-content">

    <h4 id="3-计算隐含的投资回报率ror"><strong>3. 计算隐含的投资回报率（ROR）</strong></h4>

    <p><b>ROR = ROE / PB </b>= ${roe * 100}% / ${currentVPb} = ${addRate}%</p>

    <hr>

  </div>
  <div id="wmd-preview-section-68" class="wmd-preview-section preview-content">

    <h4 id="4-计算风险溢价"><strong>4. 计算风险溢价</strong>(跟国债${treasuryRate * 100}%相比)</h4>

    <p><b>风险溢价 = ROR - 国债利率 </b>= ${addRate}% - ${treasuryRate * 100}% = ${latestRate}%</p>
  </div>
<div id="wmd-preview-section-75" class="wmd-preview-section preview-content">

<h4 id="5-结论与建议"><strong>5. 结论与建议</strong></h4>

</div>
<div id="wmd-preview-section-76" class="wmd-preview-section preview-content">

<h4 id="1-当前溢价合理性"><strong>(1) 当前溢价合理性</strong></h4>

<ul>
<li><p><strong>PB=${currentPb}倍</strong> 也处于 <strong>市场历史区间（${(historicalMin / BValue).toFixed(2)}~${(historicalMax / BValue).toFixed(2)}倍）</strong> 中间位置。</p></li>
</ul>
<h4 id="1-当前溢价合理性"><strong>(2) 债券类比</strong></h4>
<div>
假设【${stockName}】的每股净资产为100元，ROE 稳定在 ${roe*100}% 左右，意味着每年能为股东创造 ${100 * roe} 元的净利润。此时若以 ${currentPb} 倍 PB 买入，相当于：
 <ul>
<li><p>本金投入：${100 * currentPb}元</p></li>
<li><p>年收益：${roe*100}元（ROE×净资产=${roeVa}%×100元）</p></li>
<li><p>预期收益率：${roe*100} 元 / ${100 * currentPb}元 ≈ ${  bondRate }%（ROE/PB）</p></li>

<li><p>这就类似于用${100 * currentPb}元购买了一份面值100元、年利率${roeVa}%的债券，虽然本金溢价${  ( 100 * currentPb - 100).toFixed(0) }%，但预期收益率（${ bondRate }%）仍${ bondRate - treasuryRate*100 > 0 ?'高于':'低于'  }当前的无风险收益率（${treasuryRate * 100}%）</p></li>
 
</ul>
</div>
</div>
</div>

    </div>
</div>
    `;

        }


        // 初始化时自动执行计算
        window.addEventListener('load', ()=>{
            calculate()
        });
    </script>

</body>

</html>
